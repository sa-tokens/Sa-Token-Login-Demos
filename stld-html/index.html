<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主页 - Sa-Token 登录示例</title>
    <link rel="stylesheet" href="static/css/common.css">
    <link rel="stylesheet" href="static/css/index.css">
    <link rel="stylesheet" href="static/kj/layer/theme/default/layer.css">
</head>
<body>
    <div class="page-container">
        <div class="card">
            <!-- 未登录时显示 -->
            <div id="not-logged-in" class="info-section" style="display: none;">
                <h1 class="page-title">当前尚未登录</h1>
                <button type="button" class="btn btn-primary" id="btn-go-login">去登录</button>
            </div>

            <!-- 已登录时显示：欢迎语、账号信息、注销按钮 -->
            <div id="logged-in" class="info-section" style="display: none;">
                <h1 class="page-title">欢迎，你已登录成功</h1>
                <div class="user-info-card">
                    <div class="user-info-row"><span class="label">用户 ID</span><span class="value" id="user-id">-</span></div>
                    <div class="user-info-row"><span class="label">用户名</span><span class="value" id="user-name">-</span></div>
                    <div class="user-info-row"><span class="label">性别</span><span class="value" id="user-gender">-</span></div>
                    <div class="user-info-row"><span class="label">年龄</span><span class="value" id="user-age">-</span></div>
                    <div class="user-info-row"><span class="label">手机号</span><span class="value" id="user-phone">-</span></div>
                    <div class="user-info-row"><span class="label">邮箱</span><span class="value" id="user-email">-</span></div>
                </div>
                <button type="button" class="btn btn-default" id="btn-logout">注销</button>
            </div>
        </div>
    </div>

    <!-- 引入 jQuery、layer、sa.js（均使用本地库，禁止 CDN） -->
    <script src="static/kj/jquery.min.js"></script>
    <script src="static/kj/layer/layer.js"></script>
    <script src="static/sa.js"></script>
    <script>
        // 页面加载时检查登录状态
        $(function () {
            // 调用后端 /acc/currUserInfo 获取当前用户信息
            sa.ajax('/acc/currUserInfo', {}, function (res) {
                var u = res.data || {};
                $('#user-id').text(u.id != null ? u.id : '-');
                $('#user-name').text(u.name || '-');
                $('#user-gender').text(u.gender || '-');
                $('#user-age').text(u.age != null ? u.age : '-');
                $('#user-phone').text(u.phone || '-');
                $('#user-email').text(u.email || '-');
                $('#logged-in').show();
            }, {
                success401: function () {
                    // 未登录时显示「当前尚未登录」及【去登录】按钮
                    $('#not-logged-in').show();
                }
            });

            // 去登录按钮点击
            $('#btn-go-login').on('click', function () {
                window.location.href = 'login-select.html';
            });

            // 注销按钮点击
            $('#btn-logout').on('click', function () {
                sa.ajax('/acc/logout', {}, function () {
                    window.location.href = 'login-select.html';
                });
            });
        });
    </script>
</body>
</html>
